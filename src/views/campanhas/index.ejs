<%
// proteÃ§Ãµes contra undefined vindas do controller
const _campanhas = Array.isArray(campanhas) ? campanhas : [];
const _sistemas Â = Array.isArray(sistemas) Â ? sistemas Â : [];
%>

<div class="d-flex justify-content-between align-items-center mb-4">
Â  <h2 class="m-0" style="font-family:'Cinzel',serif; letter-spacing:.5px;">
Â  Â  <i class="bi bi-book me-2"></i> Campanhas
Â  </h2>
Â  <div class="d-flex gap-2">
Â  Â  <a href="/campanhas/criar" class="btn btn-primary btn-ring">
Â  Â  Â  <i class="bi bi-plus-lg me-1"></i> Nova campanha
Â  Â  </a>
Â  </div>
</div>

<div class="arc-card p-3 mb-3">
Â  <div class="row g-3">
Â  Â  <div class="col-md-6 col-lg-4">
Â  Â  Â  <label class="form-label">Buscar</label>
Â  Â  Â  <input id="cmpFilterSearch" type="search" class="form-control" placeholder="nome ou descriÃ§Ã£o">
Â  Â  </div>
Â  Â  <div class="col-md-6 col-lg-4">
Â  Â  Â  <label class="form-label">Sistema</label>
Â  Â  Â  <select id="cmpFilterSistema" class="form-select">
Â  Â  Â  Â  <option value="">Todos os sistemas</option>
Â  Â  Â  Â  <% _sistemas.forEach(s => { %>
Â  Â  Â  Â  Â  <option value="<%= s %>"><%= s %></option>
Â  Â  Â  Â  <% }) %>
Â  Â  Â  </select>
Â  Â  </div>
Â  </div>
</div>

<% if (_campanhas.length === 0) { %>
Â  <div class="empty">
Â  Â  <i class="bi bi-collection fs-1 d-block mb-2"></i>
Â  Â  <p class="mb-0">Nenhuma campanha encontrada.</p>
Â  </div>
<% } else { %>
Â  <div id="cmpGrid" class="row g-3">
Â  Â  <% _campanhas.forEach(c => { %>
Â  Â  Â  <div class="col-12 col-md-6 col-xl-4 cmp-card" data-sistema="<%= c.sistema || '' %>" data-name="<%= (c.nome || '') + ' ' + (c.descricao || '') %>">
Â  Â  Â  Â  <div class="arc-card h-100 campaign-card">
Â  Â  Â  Â  Â  <div class="arc-cover" <% if (c.capaUrl) { %>
Â  Â  Â  Â  Â  Â  Â  Â style="background-image:url('<%= c.capaUrl %>'); background-size:cover; background-position:center;"
Â  Â  Â  Â  Â  Â  Â <% } %>></div>
Â  Â  Â  Â  Â  <div class="arc-body">
Â  Â  Â  Â  Â  Â  <div class="d-flex align-items-center justify-content-between mb-1">
Â  Â  Â  Â  Â  Â  Â  <span class="arc-badge"><i class="bi bi-dice-5"></i> <%= c.sistema || 'â€”' %></span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <h3 class="arc-title"><%= c.nome %></h3>
Â  Â  Â  Â  Â  Â  <p class="text-muted small mb-3"><%= c.descricao || 'Sem descriÃ§Ã£o.' %></p>
Â  Â  Â  Â  Â  Â  <div class="mt-auto d-flex gap-2">
Â  Â  Â  Â  Â  Â  Â  <a class="btn btn-primary flex-fill" href="/campanhas/<%= c.id %>">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="bi bi-play-fill me-1"></i> Entrar
Â  Â  Â  Â  Â  Â  Â  </a>
                <!-- ðŸš¨ CORREÃ‡ÃƒO DE ROTEAMENTO AQUI -->
Â  Â  Â  Â  Â  Â  Â  <a class="btn btn-ring" href="/campanhas/<%= c.id %>/editar" title="Editar">
  <i class="bi bi-pencil"></i>
</a>
<a class="btn btn-danger btn-ring" href="/campanhas/<%= c.id %>/apagar" title="Apagar">
  <i class="bi bi-trash"></i>
</a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  <% }) %>
Â  </div>
<% } %>

<script>
(function(){
Â  const q = document.getElementById('cmpFilterSearch');
Â  const sel = document.getElementById('cmpFilterSistema');
Â  const cards = Array.from(document.querySelectorAll('.cmp-card'));

Â  function applyFilters(){
Â  Â  const term = (q?.value || '').toLowerCase().trim();
Â  Â  const sistema = sel?.value || '';
Â  Â  cards.forEach(el => {
Â  Â  Â  const sys = el.getAttribute('data-sistema') || '';
Â  Â  Â  const name = (el.getAttribute('data-name') || '').toLowerCase();
Â  Â  Â  const okSys = !sistema || sys === sistema;
Â  Â  Â  const okTerm = !term || name.includes(term);
Â  Â  Â  el.style.display = okSys && okTerm ? '' : 'none';
Â  Â  });
Â  }

Â  q?.addEventListener('input', applyFilters);
Â  sel?.addEventListener('change', applyFilters);
})();
</script>